# مستند AFF2
مستند نگارش ۲ قلم آراسته.

## این مستند چیست
آراسته نیازهایی دارد که با AFF نگارش ۱ برآورده نمی‌شوند. مثل پشتیبانی از متن قلم متغیر، دبیره‌های دیگری مثل لاتین در کنار عربی و متن دوسویه.


## ویژگی‌های AFF نگارش ۲
این نگارش از چند امکان پشتیبانی می‌کند:
- امکان تعریف گلیف‌هایی که مربوط به یک نویسه یا یک رشته از نویسه‌ها هستند.
- امکان تعیین تنوع هر نویسه یا هر رشتهٔ نویسه. (اول، وسط، آخر، تنها)
- امکان تعیین سویهٔ هر نویسه. (راست‌به‌چپ، چپ‌به‌راست)

## ساختار فایل
این یک فایل متنی است.

خط اول این فایل متنی سربرگ است که شامل موارد زیر است:


```
aff2 A B C D E
```

این سرآیند از ۶ بخش تشکیل شده است. بخش اول آن aff2 است که نمایانگر فرمت فایل می‌باشد.  
۵ مورد بعدی عدد هستند که توضیحات آن‌ها در زیر آمده است.
1. ارتفاع نویسه‌ها که باید عددی ثابت باشد.
2. خط کرسی. شمارهٔ خط کرسی نویسه‌ها از بالا. شماره‌گذاری خطوط از ۱ آغاز می‌شود.
3. تعداد خط‌های کامنت (توضیحات) که بعد از سرآیند می‌آید.
4. بیشینهٔ طول بلوک. طول بزرگ‌ترین بلوک (اندازهٔ طولانی‌ترین خط در بین همهٔ بلوک‌ها).
5. تعداد بلوک‌های موجود در قلم

**نکته**: در نرم‌افزار آراسته، از مورد چهارم یعنی بیشینهٔ طول بلوک و مورد پنجم یعنی تعداد بلوک‌های موجود در قلم استفاده نشده است. درواقع این موارد اطلاعاتی به قلم اضافه نمی‌کنند و تنها برای راهنمایی کاربرد دارند.



چند خط بعدی توضیحات هستند. مواردی مانند اسم طراح قلم، پروانهٔ قلم یا تاریخ انتشار را می‌توانید در این‌جا ذکر کنید. تعداد خطوط توضیحات باید در سربرگ مشخص شود.

بعد از سربرگ و توضیحات، نوبت تعریف هر گلیف می‌رسد. به هر یک از آن‌ها یک بلوک می‌گوییم.


### بلوک‌ها

هر بلوک از یک سربرگ و سپس نویسه‌های خود بلوک تشکیل می‌شود. ارتفاع همهٔ بلوک‌ها باید باهم یکسان باشد.

سربرگ بلوک از ۲ خط تشکیل شده است. مانند زیر و شامل موارد زیر است.
```
A
B C
```

1. یک نویسه یا یک رشته از نویسه‌ها. این در یک خط مستقل می‌آید.
2. تنوع این نویسه. اگر تنوع مهم نیست یا می‌خواهید همه‌جا قابل‌استفاده باشد، از عدد 0 استفاده کنید. اعداد 1 تا 4 هم به‌ترتیب برای تنوع‌های اول، وسط، آخر، تنها هستند.
3. سویهٔ نویسه. برای قلم‌های راست‌به‌چپ این عدد 1 است و برای قلم‌های چپ‌به‌راست این عدد 0 است. 

بعد از دو خط سربرگ، خود حروف گلیف در تعدادی خط می‌آیند. مشابه شکل زیر:

```
ب
1 1
            
            
            
          ██
  ██████████
            
      ██    
            
```

## نحوهٔ استفاده از این قلم
نرم‌افزارهای هنر اسکی مانند آراسته، ابتدا باتوجه‌به سربرگ قلم و سربرگ‌های نویسه‌ها، آن‌ها را می‌خواند و نگاشتی از رشته‌ها به گلیف‌ها ایجاد می‌کند.

هنگامی که می‌خواهد یک نوشته را رندر کند تا هنراسکی آن را بسازد، ابتدا دنبال بلندترین زیررشته‌ای از آن می‌گردد که در فهرستش موجود باشد.

سپس به تنوع محل قرارگیری آن رشته در فهرست نگاه می‌کند. اگر مطابق با زیررشتهٔ موجود در متن باشد، از آن برای رندر استفاده می‌کند. اگر مطابق نباشد، سراغ موردی که عدد تنوع آن صفر است می‌رود و از آن استفاده می‌کند. اگر تنوع صفر هم موجود نباشد، سراغ زیررشته‌های با طول کوتاه‌تر می‌رود.

بعد با توجه به راست‌به‌چپ یا چپ‌به‌راست بودن، این گلیف‌ها را پشت سر هم می‌چیند.

برای پشتیبانی از متن دوسویه، نرم‌افزاری مثل آراسته لازم است ابتدا زیررشته‌های راست‌به‌چپ و چپ‌به‌راست را در متن جدا کند و هر یک را جداگانه در جهت خودش رندر کند و سپس به هم بچسباند. البته الگوریتم مورداستفاده برای این کار بستگی به خود نرم‌افزار دارد اما انتظار می‌رود گلیف‌های یک نوشتهٔ لاتین از چپ به راست و گلیف‌های یک نوشتهٔ عربی از راست به چپ پشت سر هم چیده شوند.

## راهنما برای طراحی قلم
می‌توانید همهٔ نویسه‌ها را مثل یک قلم flf یا aff1 طراحی کنید. فقط باید به سربرگ‌ها توجه کنید و آن‌ها را با استاندارد جدید تطبیق دهید. همچنین دقت کنید که در استاندارد aff2 در انتهای خطوط نویسهٔ «@» وجود ندارد.

سپس برای نویسه‌هایی مثل سریا، لازم است رشته‌هایی با طول بیشتر از یک نویسه تعریف کنید. مثلاً برای سریا ممکن است چنین بلوکی ایجاد کنید:

```
هٔ
3 1

  _
 (_
___)
  __
 /  |
 \__|
    \____



```

خط اول بلوک بالا نشان می‌دهد که این بلوک برای رشتهٔ سریا که از کنارهم‌چیده‌شدن دو نویسهٔ «ه» و «ٔ» تشکیل شده، طراحی شده است.

عدد اول در خط دوم نشان می‌دهد که این برای تنوع سوم سریا است. یعنی وقتی که از سمت راست به حرف دیگری بچسبد ولی از سمت چپ به حرف دیگری نچسبد.

عدد دوم در خط دوم نشان می‌دهد که این مربوط به یک قلم راست‌به‌چپ است که خانوادهٔ عربی از این نوع هستند.

چند خط بعدی شکل گلیف سریا (ـهٔ) را با نویسه‌های اسکی ترسیم کرده است که به شکل یک «ـه» در تنوع سوم آن به همراه یک «ی» کوچک در بالای آن است.

همچنین تعداد خط‌ها در این بلوک مهم است. فرض شده که ارتفاع هر بلوک در سربرگ این قلم برابر ۱۱ خط تعریف شده است و خط شمارهٔ ۸ به‌عنوان خط کرسی مشخص شده است. 